<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="If you haven&rsquo;t read the third article of this series, I highly recommend that you do so.
This is the point where we will develop our JavaScript library that utilizes the functions exposed in the WebAssembly module. I have created a simple template for this purpose. You may notice that we are defining some imports for WASI, but they are all empty. Allow me to explain what WASI is and what it aims to achieve. WASI is an attempt to create specifications similar to the POSIX standard, which can be implemented across different runtimes, such as browsers or regular machines, and provides access to system-specific functions, such as file systems. However, for our library, which only needs to perform calculations, we do not require a complex runtime environment. This is why our functions are empty. Some may argue that we should use the Emscripten SDK instead of the WASI SDK, but I believe that the WASI SDK is the future. It produces smaller binaries and has fewer complications compared to Emscripten. There are official efforts to import standard WASI functions for the browser, but unfortunately, they do not seem to work unless a WebAssembly module is instantiated within a worker. If there are any changes in the future regarding this matter, I will update my articles accordingly. Here is the mentioned attempt to bring a WASI runtime to browsers. If you can load a WASM file outside the worker, just email me your solution and I will include it here! &#x1f604;
"><meta name=keywords content="homepage,blog"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://ercanakyuerek.de/posts/wasi/wasi-sdk-writing-library-in-cpp-4/><title>Writing a Library in C++ and Using it in the Browser with the WASI SDK - JavaScript module :: Ercan Aky√ºrek</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/main.447abdd8b05d65d4423dba337b174c64e4f39316113d8a1039b556710de1f772.css integrity="sha256-RHq92LBdZdRCPbozexdMZOTzkxYRPYoQObVWcQ3h93I="><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Writing a Library in C++ and Using it in the Browser with the WASI SDK - JavaScript module"><meta itemprop=description content="If you haven‚Äôt read the third article of this series, I highly recommend that you do so.
This is the point where we will develop our JavaScript library that utilizes the functions exposed in the WebAssembly module. I have created a simple template for this purpose. You may notice that we are defining some imports for WASI, but they are all empty. Allow me to explain what WASI is and what it aims to achieve. WASI is an attempt to create specifications similar to the POSIX standard, which can be implemented across different runtimes, such as browsers or regular machines, and provides access to system-specific functions, such as file systems. However, for our library, which only needs to perform calculations, we do not require a complex runtime environment. This is why our functions are empty. Some may argue that we should use the Emscripten SDK instead of the WASI SDK, but I believe that the WASI SDK is the future. It produces smaller binaries and has fewer complications compared to Emscripten. There are official efforts to import standard WASI functions for the browser, but unfortunately, they do not seem to work unless a WebAssembly module is instantiated within a worker. If there are any changes in the future regarding this matter, I will update my articles accordingly. Here is the mentioned attempt to bring a WASI runtime to browsers. If you can load a WASM file outside the worker, just email me your solution and I will include it here! üòÑ"><meta itemprop=datePublished content="2023-02-27T17:45:00+01:00"><meta itemprop=dateModified content="2023-02-27T17:45:00+01:00"><meta itemprop=wordCount content="1075"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writing a Library in C++ and Using it in the Browser with the WASI SDK - JavaScript module"><meta name=twitter:description content="If you haven‚Äôt read the third article of this series, I highly recommend that you do so.
This is the point where we will develop our JavaScript library that utilizes the functions exposed in the WebAssembly module. I have created a simple template for this purpose. You may notice that we are defining some imports for WASI, but they are all empty. Allow me to explain what WASI is and what it aims to achieve. WASI is an attempt to create specifications similar to the POSIX standard, which can be implemented across different runtimes, such as browsers or regular machines, and provides access to system-specific functions, such as file systems. However, for our library, which only needs to perform calculations, we do not require a complex runtime environment. This is why our functions are empty. Some may argue that we should use the Emscripten SDK instead of the WASI SDK, but I believe that the WASI SDK is the future. It produces smaller binaries and has fewer complications compared to Emscripten. There are official efforts to import standard WASI functions for the browser, but unfortunately, they do not seem to work unless a WebAssembly module is instantiated within a worker. If there are any changes in the future regarding this matter, I will update my articles accordingly. Here is the mentioned attempt to bring a WASI runtime to browsers. If you can load a WASM file outside the worker, just email me your solution and I will include it here! üòÑ"><meta property="og:url" content="https://ercanakyuerek.de/posts/wasi/wasi-sdk-writing-library-in-cpp-4/"><meta property="og:site_name" content="Ercan Aky√ºrek"><meta property="og:title" content="Writing a Library in C++ and Using it in the Browser with the WASI SDK - JavaScript module"><meta property="og:description" content="If you haven‚Äôt read the third article of this series, I highly recommend that you do so.
This is the point where we will develop our JavaScript library that utilizes the functions exposed in the WebAssembly module. I have created a simple template for this purpose. You may notice that we are defining some imports for WASI, but they are all empty. Allow me to explain what WASI is and what it aims to achieve. WASI is an attempt to create specifications similar to the POSIX standard, which can be implemented across different runtimes, such as browsers or regular machines, and provides access to system-specific functions, such as file systems. However, for our library, which only needs to perform calculations, we do not require a complex runtime environment. This is why our functions are empty. Some may argue that we should use the Emscripten SDK instead of the WASI SDK, but I believe that the WASI SDK is the future. It produces smaller binaries and has fewer complications compared to Emscripten. There are official efforts to import standard WASI functions for the browser, but unfortunately, they do not seem to work unless a WebAssembly module is instantiated within a worker. If there are any changes in the future regarding this matter, I will update my articles accordingly. Here is the mentioned attempt to bring a WASI runtime to browsers. If you can load a WASM file outside the worker, just email me your solution and I will include it here! üòÑ"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-27T17:45:00+01:00"><meta property="article:modified_time" content="2023-02-27T17:45:00+01:00"><meta property="article:published_time" content="2023-02-27 17:45:00 +0100 +0100"><script async src="https://www.googletagmanager.com/gtag/js?id=G-WCX2MRFT7Z"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-WCX2MRFT7Z")}</script></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>ercanakyuerek.de</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>About me</a></li><li><a href=/posts>Blog</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 minutes</p></div><article><h1 class=post-title><a href=https://ercanakyuerek.de/posts/wasi/wasi-sdk-writing-library-in-cpp-4/>Writing a Library in C++ and Using it in the Browser with the WASI SDK - JavaScript module</a></h1><div class=post-content><p><a href=https://ercanakyuerek.de/posts/wasi/wasi-sdk-writing-library-in-cpp-3/>If you haven&rsquo;t read the third article of this series, I highly recommend that you do so.</a></p><p>This is the point where we will develop our <code>JavaScript</code> library that utilizes the functions exposed in the <code>WebAssembly</code> module. I have created a simple template for this purpose. You may notice that we are defining some imports for <code>WASI</code>, but they are all empty. Allow me to explain what <code>WASI</code> is and what it aims to achieve. <code>WASI</code> is an attempt to create specifications similar to the <code>POSIX</code> standard, which can be implemented across different runtimes, such as browsers or regular machines, and provides access to system-specific functions, such as file systems. However, for our library, which only needs to perform calculations, we do not require a complex runtime environment. This is why our functions are empty. Some may argue that we should use the Emscripten SDK instead of the <code>WASI SDK</code>, but I believe that the <code>WASI SDK</code> is the future. It produces smaller binaries and has fewer complications compared to <code>Emscripten</code>. There are official efforts to import standard <code>WASI</code> functions for the <code>browser</code>, but unfortunately, they do not seem to work unless a <code>WebAssembly module</code> is instantiated within a <code>worker</code>. If there are any changes in the future regarding this matter, I will update my articles accordingly. <a href=https://github.com/wasmerio/wasmer-js>Here</a> is the mentioned attempt to bring a <code>WASI runtime</code> to <code>browsers</code>. If you can load a <code>WASM file</code> outside the <code>worker</code>, just email me your solution and I will include it here! &#x1f604;</p><h2 id=instantiate-a-module>Instantiate a module</h2><p>Let&rsquo;s create a small boilerplate code for this purpose in the <code>index.js</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>glue</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./glue.wasm&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>libCalculation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>wasmFileResponsePromise</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>memory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>Memory</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>initial</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10000</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maximum</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10000</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>module</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>compileStreaming</span>(<span style=color:#a6e22e>wasmFileResponsePromise</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>instance</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>WebAssembly</span>.<span style=color:#a6e22e>instantiate</span>(<span style=color:#a6e22e>module</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wasi_snapshot_preview1</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>environ_get</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>environ_sizes_get</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_close</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_fdstat_get</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_read</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_write</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>proc_exit</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_seek</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_fdstat_set_flags</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_prestat_get</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fd_prestat_dir_name</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>path_open</span><span style=color:#f92672>:</span> () =&gt; {},
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>memory</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... here comes our wrapped functions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ... going to export them here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    };
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>libCalculation</span>;
</span></span></code></pre></div><p>We will need to discuss memory later, particularly linear memory. For now, let&rsquo;s wrap some WebAssembly functions. We will start with an easy one, <code>getSplineLength</code>. We can get the function from the <code>instance.exports</code> and call it with the spline pointer. This function returns a float, so there is no need for any special handling here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getSplineLength</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>splinePointer</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>getSplineLength</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>func</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>func</span>(<span style=color:#a6e22e>splinePointer</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Let&rsquo;s move on to a more complicated function, <code>getSplinePositionAtDistance</code>. We also need to get the function from the exports and call it with the <code>spline pointer</code> and a <code>distance</code>. However, we need to handle the <code>3D vector</code> pointer from the function&rsquo;s return in order to extract the float <code>x, y, and z</code> values from the <code>3D vector</code>.The <code>3D vector</code> includes three <code>float</code> values. That&rsquo;s why we use <code>Float32Array</code> instead of <code>Float64Array</code>, which would be used for doubles. The first argument is the memory itself, the second one is the <code>position</code> in the <code>memory</code> (a pointer is simply a number), and we want to extract <code>3x 32bit values</code>, which perfectly match <code>3x float for x, y, and z</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getSplinePositionAtDistance</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>splinePointer</span>, <span style=color:#a6e22e>distance</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>getSplinePositionAtDistance</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>func</span>, <span style=color:#a6e22e>memory</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>positionPointer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>func</span>(<span style=color:#a6e22e>splinePointer</span>, <span style=color:#a6e22e>distance</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Float32Array</span>(<span style=color:#a6e22e>memory</span>, <span style=color:#a6e22e>positionPointer</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now we reached an interesting function, createSpline, which takes four parameters of type <code>3d vector</code>. In this case we can just allocate <code>4x3x32bit</code>, four control points, <code>x, y, z</code> for each point, each point is a float which are <code>32bit</code>, which makes <code>48 bytes</code> in total. So we first need to allocate <code>48 bytes</code>. For this, we can easily use our malloc function, which we exposed in the webassembly module. I know, this is NOT a perfect solution, and there are some limitations, when I come up with better solutions, there will be some changes. So, at javascript side, we need to allocate <code>48 bytes</code>, put all <code>p0 - p1</code> coordinates in to the memory and pass the memory pointer to the arguments. We also can allocate for each parameter, so we can all <code>4 times malloc</code> with <code>12 bytes</code> each malloc. I decided to do the latter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>createSpline</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>p0</span>, <span style=color:#a6e22e>p1</span>, <span style=color:#a6e22e>p2</span>, <span style=color:#a6e22e>p3</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>createSpline</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>func</span>, <span style=color:#a6e22e>malloc</span>, <span style=color:#a6e22e>memory</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>exports</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pointers</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>p0</span>, <span style=color:#a6e22e>p1</span>, <span style=color:#a6e22e>p2</span>, <span style=color:#a6e22e>p3</span>].<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>point</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pointer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>malloc</span>(<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>); <span style=color:#75715e>// (x, y, z) * 4 bytes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Float32Array</span>(<span style=color:#a6e22e>memory</span>.<span style=color:#a6e22e>buffer</span>, <span style=color:#a6e22e>pointer</span>, <span style=color:#ae81ff>3</span>).<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>point</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pointer</span>;
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>func</span>(<span style=color:#a6e22e>pointers</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>pointers</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>pointers</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>pointers</span>[<span style=color:#ae81ff>3</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>export all function &#x1f604;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createSpline</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>getSplinePositionAtDistance</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>getSplineLength</span>
</span></span><span style=display:flex><span>    };
</span></span></code></pre></div><h2 id=testing-our-library>Testing our library</h2><p>For testing purposes, you can create an <code>index.html</code> file and install the <code>http-serve</code> package by running the command <code>npm install http-serve --save-dev</code>. To start the server, run the command <code>node_modules/.bin/http-server .</code> and include the following content in the <code>index.html</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;module&#34;</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>import</span> <span style=color:#a6e22e>libCalculation</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./index.js&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>init</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> () =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>createSpline</span>, <span style=color:#a6e22e>getSplineLength</span>, <span style=color:#a6e22e>getSplinePositionAtDistance</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>libCalculation</span>(<span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;glue.wasm&#34;</span>));
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>spline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSpline</span>([<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#ae81ff>3</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>splineLength</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getSplineLength</span>(<span style=color:#a6e22e>spline</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getSplinePositionAtDistance</span>(<span style=color:#a6e22e>spline</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>splineLength</span>, <span style=color:#a6e22e>position</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>init</span>();
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><iframe src=https://ercanakyuerek.de//%25!s%28%3cnil%3e%29 width=200px height=200px style=border:0 class=embedded-iframe></iframe><p>Please check the console for a spline with a length of <code>10.06</code>. The position we fetched should return a 3D vector with coordinates of <code>[-3, -3, 0]</code>.
Next to this text, you can view an advanced test that displays a spline. I have created a <a href=https://github.com/geforcefan/ercanakyuerek.de/tree/main/static/wasi-sdk-writing-library-in-cpp/libCalculation>repository</a> that contains all the necessary files, including this advanced example that uses Three.js for rendering.</p><h2 id=conclusion>Conclusion</h2><p>That&rsquo;s all! It wasn&rsquo;t that difficult, was it? We haven&rsquo;t yet covered other complex types, such as passing strings to and from WebAssembly modules, or how to log. However, you should have a rough idea of how things work now. In future articles, I will explore data types, memory management, and binding in greater depth. To be honest, gluing code together is not enjoyable. It requires creating glue code on the C++ side and a wrapper JavaScript module that <code>serializes</code> and <code>unserializes</code> arguments and return values. Some solutions eliminate the need for writing both code pieces, but for now, this should help you get started, especially if you aim to build a small yet performance-critical library.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1075 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2023-02-27 16:45</p></div><hr><div class=sharing-buttons><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;caption=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;canonicalUrl=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on tumblr"><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093.0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941.0 9.999.0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;body=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a><a class=resp-sharing-button__link href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f&amp;media=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f;description=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module" target=_blank rel=noopener aria-label title="Share on pinterest"><div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017.0C5.396.0.029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024.0 1.518.769 1.518 1.688.0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128.0 3.768-2.245 3.768-5.487.0-2.861-2.063-4.869-5.008-4.869-3.41.0-5.409 2.562-5.409 5.199.0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646.0-3.776 2.748-7.252 7.92-7.252 4.158.0 7.392 2.967 7.392 6.923.0 4.135-2.607 7.462-6.233 7.462-1.214.0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607.0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017.0z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f&amp;title=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;summary=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;source=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f&amp;resubmit=true&amp;title=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f;title=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module" target=_blank rel=noopener aria-label title="Share on xing"><div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module%20https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f&amp;t=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module" target=_blank rel=noopener aria-label title="Share on hacker news"><div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=Writing%20a%20Library%20in%20C%2b%2b%20and%20Using%20it%20in%20the%20Browser%20with%20the%20WASI%20SDK%20-%20JavaScript%20module&amp;url=https%3a%2f%2fercanakyuerek.de%2fposts%2fwasi%2fwasi-sdk-writing-library-in-cpp-4%2f" target=_blank rel=noopener aria-label title="Share on telegram"><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div></div></a></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://ercanakyuerek.de/posts/rollercoaster-simulation/improved-spline-interpolation/><span class=button__icon>‚Üê</span>
<span class=button__text>Roller Coaster Simulation - Improved spline interpolation</span>
</a></span><span class="button next"><a href=https://ercanakyuerek.de/posts/wasi/wasi-sdk-writing-library-in-cpp-3/><span class=button__text>Writing a Library in C++ and Using it in the Browser with the WASI SDK - Implementing library functions</span>
<span class=button__icon>‚Üí</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.257531934bfbdf8527f52eab4b38eb8211337125b54dae74132499837c006508dae0d544e859d909af1be266d147861c1c1e688de0f7d2cc2f258de78a9b8a6a.js integrity="sha512-JXUxk0v734Un9S6rSzjrghEzcSW1Ta50EySZg3wAZQja4NVE6FnZCa8b4mbRR4YcHB5ojeD30swvJY3nipuKag=="></script></body></html>